Refactored in 81598c0704ce082af7028d9b03c4bf7f54bd82d8. Epic implementation no longer used here.
